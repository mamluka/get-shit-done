---
phase: 22-structural-refactor
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - get-shit-done/workflows/*.md
  - get-shit-done/templates/*.md
  - get-shit-done/references/*.md
  - commands/gsd-pm/*.md
  - agents/gsd-*.md
  - get-shit-done/bin/gsd-tools.test.js
autonomous: true

must_haves:
  truths:
    - "All workflow files reference .planning-pm/ instead of .planning/"
    - "All template files reference .planning-pm/ instead of .planning/"
    - "All reference files reference .planning-pm/ instead of .planning/"
    - "All command files reference .planning-pm/ instead of .planning/"
    - "All agent files reference .planning-pm/ instead of .planning/"
    - "All test assertions use .planning-pm/ paths"
  artifacts:
    - path: "get-shit-done/workflows/sync-jira.md"
      provides: "Jira sync workflow with .planning-pm paths"
      contains: ".planning-pm"
    - path: "get-shit-done/workflows/new-project.md"
      provides: "Project initialization workflow with .planning-pm paths"
      contains: ".planning-pm"
    - path: "get-shit-done/templates/state.md"
      provides: "STATE.md template with .planning-pm references"
      contains: ".planning-pm"
    - path: "get-shit-done/bin/gsd-tools.test.js"
      provides: "Tests validating .planning-pm path behavior"
      contains: ".planning-pm"
  key_links:
    - from: "get-shit-done/workflows/*.md"
      to: ".planning-pm/ directory"
      via: "Path references in workflow instructions and bash snippets"
      pattern: "\\.planning-pm/"
    - from: "get-shit-done/templates/*.md"
      to: ".planning-pm/ directory"
      via: "Template path references and example paths"
      pattern: "\\.planning-pm/"
    - from: "get-shit-done/bin/gsd-tools.test.js"
      to: "get-shit-done/bin/gsd-tools.js PathResolver"
      via: "Test assertions creating and checking .planning-pm directories"
      pattern: "\\.planning-pm"
---

<objective>
Rename all `.planning` references to `.planning-pm` across all markdown content files (workflows, templates, references, commands, agents) and the gsd-tools test file.

Purpose: The JS infrastructure (Plan 01) resolves paths to `.planning-pm`. All markdown files that instruct Claude workflows and agents must reference the same `.planning-pm` path, otherwise workflow instructions will conflict with actual path resolution. The test file must also match to validate the new paths.

Output: 100+ markdown files and 1 test file with `.planning` replaced by `.planning-pm`
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename .planning to .planning-pm in all markdown content files</name>
  <files>
get-shit-done/workflows/*.md
get-shit-done/templates/*.md
get-shit-done/references/*.md
commands/gsd-pm/*.md
agents/gsd-*.md
  </files>
  <action>
Perform a bulk find-and-replace of `.planning` with `.planning-pm` across all markdown files in the following directories:

1. **get-shit-done/workflows/** (31 files) - Workflow instructions containing path references like `.planning/STATE.md`, `.planning/config.json`, `.planning/phases/`, `.planning/ROADMAP.md`, `@.planning/`, etc.

2. **get-shit-done/templates/** (30 files) - Document templates containing example paths, `@.planning/` context references, and instructions referencing the planning directory.

3. **get-shit-done/references/** (7 files) - Reference documents containing path examples and conventions.

4. **commands/gsd-pm/** (26 files) - Command definitions containing path references in execution flows.

5. **agents/** (8 files matching gsd-*.md) - Agent definitions containing path references in execution flows and context references.

**Replacement rules:**
- Replace `.planning/` with `.planning-pm/` (path references)
- Replace `.planning` with `.planning-pm` when it appears as a standalone directory name (e.g., "the `.planning` directory" becomes "the `.planning-pm` directory")
- Replace `@.planning/` with `@.planning-pm/` (context file references)
- Replace `".planning"` with `".planning-pm"` and `'.planning'` with `'.planning-pm'` (quoted strings)
- Do NOT replace `.planning-pm` (already correct - avoid double-renaming)

**Use a bash loop with sed for efficiency:**
```bash
# For each directory, find all .md files and replace
for dir in get-shit-done/workflows get-shit-done/templates get-shit-done/references commands/gsd-pm; do
  find "$dir" -name "*.md" -exec sed -i '' 's/\.planning\([^-]\)/\.planning-pm\1/g; s/\.planning$/\.planning-pm/g' {} +
done

# Agents directory (specific pattern)
find agents -name "gsd-*.md" -exec sed -i '' 's/\.planning\([^-]\)/\.planning-pm\1/g; s/\.planning$/\.planning-pm/g' {} +
```

**IMPORTANT edge cases:**
- The `.planning-pm` string itself must NOT be further replaced. The sed pattern `\.planning\([^-]\)` handles this by requiring a non-hyphen character after `.planning`.
- Watch for end-of-line occurrences where `.planning` appears at the very end of a line (the second sed pattern `\.planning$` handles this).
- Some files may have `.planning` in backtick code spans (`` `.planning` ``) -- these should ALSO be replaced.
- The `commands/gsd-pm/new-project.md.bak` file should also be updated if it exists.

After replacement, spot-check a few key files to verify:
- `get-shit-done/workflows/new-project.md` should reference `.planning-pm/`
- `get-shit-done/workflows/sync-jira.md` should reference `.planning-pm/jira-sync.json`
- `get-shit-done/templates/state.md` should reference `.planning-pm/`
- `agents/gsd-planner.md` should reference `.planning-pm/`
  </action>
  <verify>
Run: `grep -r "\.planning/" get-shit-done/workflows/ get-shit-done/templates/ get-shit-done/references/ commands/gsd-pm/ agents/gsd-*.md 2>/dev/null | grep -v "\.planning-pm" | head -20`
Expected: No output (all .planning/ references are now .planning-pm/)

Run: `grep -c "\.planning-pm" get-shit-done/workflows/new-project.md` -- should be > 0
Run: `grep -c "\.planning-pm" get-shit-done/workflows/sync-jira.md` -- should be > 0
Run: `grep -c "\.planning-pm" get-shit-done/templates/state.md` -- should be > 0
Run: `grep -c "\.planning-pm" agents/gsd-planner.md` -- should be > 0

Run: `grep -rl "\.planning-pm" get-shit-done/workflows/ | wc -l` -- should be approximately 31
Run: `grep -rl "\.planning-pm" get-shit-done/templates/ | wc -l` -- should be approximately 30
Run: `grep -rl "\.planning-pm" commands/gsd-pm/ | wc -l` -- should be approximately 26
  </verify>
  <done>
All workflow, template, reference, command, and agent markdown files reference `.planning-pm/` instead of `.planning/`. Zero remaining `.planning/` references across these directories (excluding `.planning-pm/` which is correct). Approximately 100+ files updated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rename .planning to .planning-pm in gsd-tools.test.js</name>
  <files>get-shit-done/bin/gsd-tools.test.js</files>
  <action>
Replace all occurrences of `.planning` with `.planning-pm` in the test file. This file has approximately 157 references, mostly in:

- Test setup creating temporary `.planning/` directories
- Assertions checking paths that contain `.planning/`
- Test fixtures referencing `.planning/config.json`, `.planning/STATE.md`, `.planning/phases/`, etc.
- `path.join(tmpDir, '.planning')` calls for test directory creation

Use the same sed approach:
```bash
sed -i '' 's/\.planning\([^-]\)/\.planning-pm\1/g; s/\.planning$/\.planning-pm/g' get-shit-done/bin/gsd-tools.test.js
```

After replacement, verify the file still parses and tests still pass:
```bash
node -c get-shit-done/bin/gsd-tools.test.js
```

Then run the tests (they depend on Plan 01's gsd-tools.js changes being in place, but the test file itself should at least parse correctly):
```bash
node --test get-shit-done/bin/gsd-tools.test.js 2>&1 | tail -5
```

If tests fail because Plan 01 hasn't been applied yet (parallel execution), that's expected. The important thing is the test file references `.planning-pm` consistently.
  </action>
  <verify>
Run: `node -c get-shit-done/bin/gsd-tools.test.js` -- must exit 0

Run: `grep -c "\.planning/" get-shit-done/bin/gsd-tools.test.js | head -1` -- pipe through grep -v .planning-pm, should be 0 remaining old references
Better: `grep "\.planning[^-]" get-shit-done/bin/gsd-tools.test.js | grep -v "\.planning-pm" | wc -l` -- should be 0

Run: `grep -c "\.planning-pm" get-shit-done/bin/gsd-tools.test.js` -- should be approximately 157
  </verify>
  <done>
gsd-tools.test.js has all `.planning` references replaced with `.planning-pm`. File parses without syntax errors. Approximately 157 references updated. Test assertions will validate `.planning-pm` paths when run alongside the updated gsd-tools.js from Plan 01.
  </done>
</task>

</tasks>

<verification>
Plan 02 is complete when:
1. Zero remaining `.planning/` references (excluding `.planning-pm/`) across all workflow, template, reference, command, and agent markdown files
2. gsd-tools.test.js has all `.planning` references updated to `.planning-pm`
3. All files parse correctly
4. FOLD-02, FOLD-03, FOLD-04 requirements are addressed
</verification>

<success_criteria>
- FOLD-02: All workflow files reference `.planning-pm/` instead of `.planning/`
- FOLD-03: All template files reference `.planning-pm/` instead of `.planning/`
- FOLD-04: All agent prompts and command definitions reference `.planning-pm/` instead of `.planning/`
</success_criteria>

<output>
After completion, create `.planning/phases/22-structural-refactor/22-02-SUMMARY.md`
</output>
