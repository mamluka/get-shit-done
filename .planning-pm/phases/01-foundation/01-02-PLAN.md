---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: [01-01]
files_modified:
  - "get-shit-done/bin/gsd-tools.js"
  - "get-shit-done/workflows/create-project.md"
  - "get-shit-done/workflows/switch-project.md"
  - "get-shit-done/workflows/list-projects.md"
  - "commands/gsd/create-project.md"
  - "commands/gsd/switch-project.md"
  - "commands/gsd/list-projects.md"
autonomous: true
must_haves:
  truths:
    - "PM can create a new project by providing a friendly name and description, which creates .planning/{slug}/ folder structure"
    - "PM can create a project with spaces and special chars in name (e.g. 'Mobile App Redesign') and system auto-generates slug ('mobile-app-redesign')"
    - "After project creation, PM is prompted 'Switch to it now?' rather than auto-activating"
    - "PM can switch between projects using /gsd:switch-project which lists available projects"
    - "PM can list all projects with /gsd:list-projects showing name, status, and current version"
    - "Each project has a PROJECT.md at project root and v1/ subfolder with STATE.md, phases/, etc."
    - "Active project is tracked in a global state file so commands know which project is active"
  artifacts:
    - path: "get-shit-done/bin/gsd-tools.js"
      provides: "create-project, switch-project, list-projects init commands and project CRUD functions"
      contains: "cmdInitCreateProject"
    - path: "get-shit-done/workflows/create-project.md"
      provides: "Interactive project creation workflow"
      contains: "project name"
    - path: "get-shit-done/workflows/switch-project.md"
      provides: "Project switching workflow"
      contains: "switch"
    - path: "get-shit-done/workflows/list-projects.md"
      provides: "Project listing workflow"
      contains: "list"
    - path: "commands/gsd/create-project.md"
      provides: "Slash command entry point for /gsd:create-project"
      contains: "create-project"
    - path: "commands/gsd/switch-project.md"
      provides: "Slash command entry point for /gsd:switch-project"
      contains: "switch-project"
    - path: "commands/gsd/list-projects.md"
      provides: "Slash command entry point for /gsd:list-projects"
      contains: "list-projects"
  key_links:
    - from: "commands/gsd/create-project.md"
      to: "get-shit-done/workflows/create-project.md"
      via: "Workflow reference in command"
      pattern: "create-project"
    - from: "create-project workflow"
      to: "gsd-tools.js init create-project"
      via: "node gsd-tools.js init create-project"
      pattern: "init create-project"
    - from: "gsd-tools.js createProjectInternal()"
      to: ".planning/{slug}/PROJECT.md and .planning/{slug}/v1/"
      via: "fs.mkdirSync + fs.writeFileSync"
      pattern: "createProjectInternal"
---

<objective>
Implement the project creation, switching, and listing commands that enable PMs to manage multiple projects.

Purpose: This creates the user-facing commands for multi-project management. PMs need to create projects (with friendly names), switch between them, and see what projects exist. These commands write the folder structure defined in INFRA-02/INFRA-03 and update state tracking per INFRA-04.

Output: Three new slash commands (/gsd:create-project, /gsd:switch-project, /gsd:list-projects) with supporting workflow files and gsd-tools.js functions.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@get-shit-done/bin/gsd-tools.js
@get-shit-done/workflows/new-project.md
@commands/gsd/new-project.md
</context>

<constraints>
CRITICAL: The .claude/ folder is the INSTALLED framework (local to each user). It is NOT part of the project codebase and must NEVER be modified, committed, or referenced as a target file. All source code changes go to the ROOT folders. The mapping is:
- Source code: get-shit-done/bin/gsd-tools.js (MODIFY THIS)
- Installed copy: .claude/get-shit-done/bin/gsd-tools.js (NEVER TOUCH)
- Source workflows: get-shit-done/workflows/*.md (MODIFY THIS)
- Installed workflows: .claude/get-shit-done/workflows/*.md (NEVER TOUCH)
- Source commands: commands/gsd/*.md (MODIFY THIS)
- Installed commands: .claude/commands/gsd/*.md (NEVER TOUCH)
</constraints>

<tasks>

<task type="auto">
  <name>Task 1: Add project CRUD functions and init commands to gsd-tools.js</name>
  <files>get-shit-done/bin/gsd-tools.js</files>
  <action>
Add the following functions and wire them into the command dispatcher in gsd-tools.js:

**1. createProjectInternal(cwd, friendlyName, description)**

Creates a new project folder structure:
```
.planning/{slug}/
  PROJECT.md          (project root — shared across versions per user decision)
  v1/
    STATE.md          (with current_project and current_version fields)
    ROADMAP.md        (empty template)
    REQUIREMENTS.md   (empty template)
    config.json       (empty {} — version-specific overrides)
    phases/           (empty directory)
```

Implementation details:
- Generate slug using existing `generateSlugInternal(friendlyName)` — zero dependencies per project constraint
- Validate: slug must be non-empty, max 50 chars, must not already exist as directory in .planning/
- If slug collision (directory exists), append `-2`, `-3` etc until unique
- PROJECT.md content: `# {friendlyName}\n\n**Created:** {date}\n**Description:** {description}\n\n## Status\nActive -- Version 1\n\n## History\n- v1: Created {date}\n`
- STATE.md content: Standard STATE.md template but with `**current_project:** {slug}` and `**current_version:** v1` added to Current Position section
- Return `{ slug, friendlyName, description, projectPath, created: true }`

**2. switchProjectInternal(cwd, projectSlug)**

Switches active project by updating a global project pointer:
- Store active project in `.planning/.active-project` file (simple text file with slug name). This avoids modifying STATE.md at the global level which doesn't exist in nested mode.
- Validate project exists: `.planning/{projectSlug}/PROJECT.md` must exist
- If project not found, return `{ error: 'Project not found', available: [list] }`
- On success, clear PathResolver cache (PathResolver.clearCache()) so next call picks up new project
- Return `{ switched: true, project: projectSlug }`

Update PathResolver to also check `.planning/.active-project` for current project context (in addition to STATE.md). The `.active-project` file is the source of truth for WHICH project is active. The version-specific STATE.md inside the project tracks current_version.

**3. listProjectsInternal(cwd)**

Lists all projects:
- Read `.planning/` directory entries
- Filter: directories only, not `_backup`, not `codebase`, not `research`, not `phases`, not `quick`, not `todos`, not `archive`
- For each candidate directory, check if `PROJECT.md` exists inside it (confirms it's a project, not some other folder)
- For each valid project, read PROJECT.md to extract friendly name (first `# ` heading) and description
- Read `.planning/.active-project` to determine which is active
- Detect latest version: find highest `v{N}` subfolder
- Return array of `{ slug, name, description, active: boolean, currentVersion, path }`

**4. cmdInitCreateProject(cwd, raw)**

Init command for create-project workflow:
```javascript
{
  planning_exists: fs.existsSync(path.join(cwd, '.planning')),
  existing_projects: listProjectsInternal(cwd),
  has_flat_structure: detectFlatStructure(cwd),  // true if .planning/STATE.md exists without .active-project
  commit_docs: loadConfig(cwd).commit_docs
}
```

**5. cmdInitSwitchProject(cwd, raw)**

Init command for switch-project workflow:
```javascript
{
  projects: listProjectsInternal(cwd),
  active_project: getActiveProject(cwd),  // read .active-project file
  has_projects: listProjectsInternal(cwd).length > 0
}
```

**6. cmdInitListProjects(cwd, raw)**

Init command for list-projects workflow:
```javascript
{
  projects: listProjectsInternal(cwd),
  active_project: getActiveProject(cwd),
  project_count: listProjectsInternal(cwd).length
}
```

**7. getActiveProject(cwd)** helper:
- Read `.planning/.active-project`, return trimmed content or null if file doesn't exist

**8. detectFlatStructure(cwd)** helper:
- Returns true if `.planning/STATE.md` exists AND `.planning/.active-project` does NOT exist AND no subdirectories with PROJECT.md exist in .planning/

**9. Update PathResolver** to incorporate `.active-project`:
- In loadProjectContext(), first check `.planning/.active-project` for the project slug
- Then read that project's latest version STATE.md for current_version
- If .active-project doesn't exist, fall back to flat mode

**10. Wire into command dispatcher:**
Add cases for `init create-project`, `init switch-project`, `init list-projects` in the main switch statement.

**Slug validation rules (Claude's discretion):**
- Strip leading/trailing whitespace
- Convert to lowercase
- Replace non-alphanumeric chars (except hyphens) with hyphens
- Collapse multiple hyphens to single
- Remove leading/trailing hyphens
- Max 50 chars (truncate, then trim trailing hyphen)
- Min 1 char after processing (reject empty result)
- Reserved names to reject: `_backup`, `codebase`, `research`, `phases`, `quick`, `todos`, `archive`, `config.json`
  </action>
  <verify>
Verify new functions exist:
```bash
grep -n "createProjectInternal\|switchProjectInternal\|listProjectsInternal\|cmdInitCreateProject\|getActiveProject" get-shit-done/bin/gsd-tools.js | head -20
```

Run existing test suite:
```bash
node --test get-shit-done/bin/gsd-tools.test.js
```

Test init commands work (will return empty/default state):
```bash
node ./get-shit-done/bin/gsd-tools.js init create-project --raw
node ./get-shit-done/bin/gsd-tools.js init list-projects --raw
```
  </verify>
  <done>gsd-tools.js contains createProjectInternal, switchProjectInternal, listProjectsInternal, init commands for all three project operations, getActiveProject helper, and PathResolver is updated to read .active-project file. Existing test suite passes.</done>
</task>

<task type="auto">
  <name>Task 2: Create workflow and command files for project management</name>
  <files>
    get-shit-done/workflows/create-project.md
    get-shit-done/workflows/switch-project.md
    get-shit-done/workflows/list-projects.md
    commands/gsd/create-project.md
    commands/gsd/switch-project.md
    commands/gsd/list-projects.md
  </files>
  <action>
Create six files: three workflow definitions and three slash command entry points.

**1. `commands/gsd/create-project.md`:**
```markdown
First, read ./get-shit-done/workflows/create-project.md for full instructions.

$ARGUMENTS
```
(Follow the pattern of existing commands like `commands/gsd/new-project.md`)

**2. `commands/gsd/switch-project.md`:**
```markdown
First, read ./get-shit-done/workflows/switch-project.md for full instructions.

$ARGUMENTS
```

**3. `commands/gsd/list-projects.md`:**
```markdown
First, read ./get-shit-done/workflows/list-projects.md for full instructions.

$ARGUMENTS
```

**4. `get-shit-done/workflows/create-project.md`:**

Interactive project creation workflow. Structure:

```
<purpose>
Create a new project with isolated folder structure for multi-project planning support.
</purpose>

<process>

## 1. Setup

INIT=$(node ./get-shit-done/bin/gsd-tools.js init create-project)

Parse JSON for: planning_exists, existing_projects, has_flat_structure, commit_docs.

If !planning_exists: mkdir -p .planning

## 2. Collect Project Details

**Per user decision: Interactive prompting with name + description.**

Ask inline (freeform): "What's the name of this project?"
- Accept friendly names with spaces, special characters, etc.
- Show the auto-generated slug: "Folder name will be: {slug}"

Ask inline (freeform): "Brief description (one line — helps when listing projects):"

## 3. Migration Check

**Per user decision: Migration only triggered when creating second project.**

If has_flat_structure AND existing_projects.length === 0:
- This means flat .planning/ structure exists with no projects yet
- This is the first time multi-project is being used
- Display: "I notice you have an existing project in .planning/. To support multiple projects, I'll need to move your existing work into a project folder."
- Ask: "I'll move your existing work into a project folder. What should I call it?" (suggest name based on PROJECT.md title if available)
- Trigger migration (handled by Plan 03's migration logic). If migration workflow not yet available, note: "Migration will be available after the migration feature is implemented. For now, creating the new project alongside existing flat structure."

## 4. Create Project

```bash
# The workflow calls createProjectInternal via a gsd-tools command
node ./get-shit-done/bin/gsd-tools.js project create "{friendlyName}" "{description}"
```

(Add `project create` command to gsd-tools.js dispatcher that calls createProjectInternal)

Display:
```
Project created:
  Name: {friendlyName}
  Folder: .planning/{slug}/
  Version: v1
```

## 5. Switch Prompt

**Per user decision: Prompt "Switch to it now?" rather than auto-activating.**

Use AskUserQuestion:
- header: "Activate Project"
- question: "Switch to {friendlyName} now?"
- options:
  - "Yes" -- Activate this project for all GSD commands
  - "No" -- Stay on current project (or no project)

If "Yes": Run switch logic (write .active-project file)
If "No": Show how to switch later: "Run /gsd:switch-project when ready."

## 6. Commit

If commit_docs:
  node ./get-shit-done/bin/gsd-tools.js commit "docs: create project {slug}" --files .planning/{slug}/PROJECT.md .planning/{slug}/v1/STATE.md

## 7. Next Steps

Display:
```
Ready! Next steps for {friendlyName}:
  /gsd:new-project — initialize project with questioning + research + requirements + roadmap
  /gsd:switch-project — switch between projects
  /gsd:list-projects — see all projects
```

</process>
```

**5. `get-shit-done/workflows/switch-project.md`:**

```
<purpose>
Switch the active project. All subsequent GSD commands will operate on the selected project.
</purpose>

<process>

## 1. Setup

INIT=$(node ./get-shit-done/bin/gsd-tools.js init switch-project)

Parse JSON for: projects, active_project, has_projects.

## 2. Handle No Projects

If !has_projects:
  Display: "No projects found. Create one with /gsd:create-project"
  Exit.

## 3. Present Projects

**Per user decision: Dedicated command that lists projects, PM picks one.**

Show project list with current active marked:

```
Available projects:

  1. Mobile App Redesign (mobile-app-redesign) — v2 [ACTIVE]
     E-commerce mobile application redesign

  2. Backend API (backend-api) — v1
     REST API for customer portal

  3. Data Pipeline (data-pipeline) — v1
     ETL pipeline for analytics
```

Use AskUserQuestion:
- header: "Switch Project"
- question: "Which project do you want to work on?"
- options: [one per project, showing friendly name]

## 4. Switch

```bash
node ./get-shit-done/bin/gsd-tools.js project switch "{selectedSlug}"
```

Display: "Switched to {friendlyName}. All GSD commands now operate on this project."

**Per user decision: Active project shown on every GSD command output.** This will be implemented by updating init commands to include project context in their output (already prepared in PathResolver).

</process>
```

**6. `get-shit-done/workflows/list-projects.md`:**

```
<purpose>
Display all projects with status at a glance.
</purpose>

<process>

## 1. Setup

INIT=$(node ./get-shit-done/bin/gsd-tools.js init list-projects)

Parse JSON for: projects, active_project, project_count.

## 2. Handle No Projects

If project_count === 0:
  Display: "No projects yet. Create one with /gsd:create-project"
  Exit.

## 3. Display Projects

**Per user decision: Separate command for project overview with status at a glance.**

Display table format:

```
Projects ({count}):

| # | Project | Slug | Version | Status |
|---|---------|------|---------|--------|
| 1 | Mobile App Redesign | mobile-app-redesign | v2 | ACTIVE |
| 2 | Backend API | backend-api | v1 | |
| 3 | Data Pipeline | data-pipeline | v1 | |

Commands:
  /gsd:switch-project — switch active project
  /gsd:create-project — create a new project
```

</process>
```

**Also add `project` command to gsd-tools.js dispatcher:**

In the main switch statement, add:
```javascript
case 'project': {
  const subcommand = args[1];
  if (subcommand === 'create') {
    // args[2] = friendlyName, args[3] = description
    const result = createProjectInternal(cwd, args[2], args[3]);
    output(result, raw);
  } else if (subcommand === 'switch') {
    const result = switchProjectInternal(cwd, args[2]);
    output(result, raw);
  } else if (subcommand === 'list') {
    const result = listProjectsInternal(cwd);
    output(result, raw);
  } else {
    error('Unknown project subcommand. Available: create, switch, list');
  }
  break;
}
```

**Update all existing init commands** to include active project context in their output. Add these fields to every init command's result object:
```javascript
active_project: getActiveProject(cwd),
project_name: getActiveProjectName(cwd),  // read friendly name from PROJECT.md
```
This enables the user decision: "Active project shown on every GSD command output."

Create helper `getActiveProjectName(cwd)`:
- Read `.planning/.active-project` for slug
- If no active project, return null
- Read `.planning/{slug}/PROJECT.md`, extract first `# ` heading
- Return the friendly name
  </action>
  <verify>
Verify all six files exist:
```bash
ls -la commands/gsd/create-project.md commands/gsd/switch-project.md commands/gsd/list-projects.md get-shit-done/workflows/create-project.md get-shit-done/workflows/switch-project.md get-shit-done/workflows/list-projects.md
```

Verify project commands work in gsd-tools:
```bash
node ./get-shit-done/bin/gsd-tools.js project list --raw
```

Run existing test suite:
```bash
node --test get-shit-done/bin/gsd-tools.test.js
```
  </verify>
  <done>Three slash commands (/gsd:create-project, /gsd:switch-project, /gsd:list-projects) exist with corresponding workflow files. gsd-tools.js has `project create/switch/list` subcommands. All existing init commands include active_project field. Existing tests pass.</done>
</task>

</tasks>

<verification>
1. `node ./get-shit-done/bin/gsd-tools.js project list --raw` returns valid JSON (empty array is fine)
2. `node ./get-shit-done/bin/gsd-tools.js init create-project --raw` returns valid JSON
3. `ls commands/gsd/create-project.md commands/gsd/switch-project.md commands/gsd/list-projects.md` all exist
4. `ls get-shit-done/workflows/create-project.md get-shit-done/workflows/switch-project.md get-shit-done/workflows/list-projects.md` all exist
5. `node --test get-shit-done/bin/gsd-tools.test.js` passes
6. `grep "active_project" get-shit-done/bin/gsd-tools.js | wc -l` returns 10+ (present in all init commands)
</verification>

<success_criteria>
- PM can create projects via gsd-tools.js project create command
- PM can switch projects via gsd-tools.js project switch command
- PM can list projects via gsd-tools.js project list command
- Project creation produces correct folder structure (.planning/{slug}/PROJECT.md, .planning/{slug}/v1/STATE.md, phases/, etc.)
- Active project tracked in .planning/.active-project file
- All init commands report active project context
- Three new slash commands and workflow files exist
- Existing test suite passes
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
