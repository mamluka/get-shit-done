---
phase: 05-jira-integration
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - get-shit-done/bin/gsd-tools.js
  - get-shit-done/workflows/new-project.md
autonomous: true

must_haves:
  truths:
    - "Before creating a new project, system checks for Jira MCP and warns if missing but allows continuation"
    - "If Jira MCP unavailable, setup instructions are provided but project creation proceeds"
    - "Core planning features work identically whether Jira MCP is installed or not"
    - "When Jira MCP is available, status is silently stored in config.json for future features"
    - "Init new-project JSON includes jira_mcp field with availability status"
  artifacts:
    - path: "get-shit-done/bin/gsd-tools.js"
      provides: "Jira MCP status in init new-project response"
      contains: "jira_mcp"
    - path: "get-shit-done/workflows/new-project.md"
      provides: "Step 1.5 Jira MCP check in project creation flow"
      contains: "check-jira-mcp"
  key_links:
    - from: "get-shit-done/workflows/new-project.md"
      to: "get-shit-done/bin/gsd-tools.js"
      via: "init new-project JSON jira_mcp field"
      pattern: "jira_mcp"
    - from: "get-shit-done/workflows/new-project.md"
      to: "get-shit-done/templates/mcp-setup/"
      via: "setup guide file path references in warning banner"
      pattern: "mcp-setup"
---

<objective>
Integrate the Jira MCP check into the project creation workflow so PMs are informed about Jira integration availability during new project setup, without blocking project creation.

Purpose: Satisfies the Phase 5 success criteria — system checks for Jira MCP before creating a new project, warns with setup instructions if missing, and stores availability for future features. The check is non-blocking: project creation proceeds regardless of MCP status.

Output: Updated init new-project with jira_mcp field, updated new-project.md workflow with Step 1.5 MCP check and informational banner.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-jira-integration/05-RESEARCH.md
@.planning/phases/05-jira-integration/05-01-SUMMARY.md
@./.claude/get-shit-done/bin/gsd-tools.js
@./.claude/get-shit-done/workflows/new-project.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Jira MCP status to init new-project response</name>
  <files>get-shit-done/bin/gsd-tools.js</files>
  <action>
Update the `cmdInitNewProject` function (line ~4806) to include Jira MCP availability in its JSON response. This follows the established pattern of capability detection in init commands (like `brave_search_available` at line 4812).

**Modify the `cmdInitNewProject` function:**

After the Brave Search detection block (line 4812-4813), add Jira MCP detection:

```javascript
// Detect Jira MCP availability
const jiraMcpStatus = checkJiraMcp();
```

Then add these fields to the `result` object (after the `brave_search_available` line, around line 4856):

```javascript
// Jira MCP integration
jira_mcp: jiraMcpStatus,
```

This adds a `jira_mcp` object to the init response with the shape:
```json
{
  "jira_mcp": {
    "available": false,
    "serverName": null,
    "message": "No Jira integration configured"
  }
}
```

The `checkJiraMcp()` function was created in Plan 05-01. It handles all edge cases (missing CLI, timeout, no match) and returns within 5 seconds.

**Update the Parse JSON documentation comment at the top of the init block** (if there is one) to include `jira_mcp` in the list of fields workflows should parse.

**IMPORTANT:**
- Do NOT modify any other init command — only `cmdInitNewProject`
- Do NOT add conditional logic that changes behavior based on MCP availability — this is detection only
- The `checkJiraMcp()` call happens once during init; the workflow reads the result from JSON (no duplicate CLI calls)
  </action>
  <verify>
1. `node get-shit-done/bin/gsd-tools.js init new-project --raw 2>/dev/null | python3 -c "import sys,json; d=json.load(sys.stdin); print(d.get('jira_mcp', 'MISSING'))"` — shows jira_mcp object (not "MISSING")
2. `grep -n "jira_mcp" get-shit-done/bin/gsd-tools.js` — confirms field added to init response
3. `grep -n "checkJiraMcp" get-shit-done/bin/gsd-tools.js` — confirms function call in cmdInitNewProject
4. `node get-shit-done/bin/gsd-tools.js init new-project --raw 2>/dev/null | python3 -c "import sys,json; d=json.load(sys.stdin); assert 'available' in d['jira_mcp']; print('OK')"` — validates shape
  </verify>
  <done>
Init new-project response includes `jira_mcp` field with `available`, `serverName`, and `message`. The check runs once during init (no duplicate CLI calls). No changes to other init commands.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Step 1.5 Jira MCP check to new-project workflow</name>
  <files>get-shit-done/workflows/new-project.md</files>
  <action>
Inject a new Step 1.5 between the existing Step 1 (Setup) and Step 2 (Brownfield Offer) in new-project.md. This step reads the Jira MCP status from the init JSON and conditionally displays an informational banner.

**Step 1: Update the Parse JSON instruction in Step 1**

In Step 1 (Setup, line ~46), the workflow parses the init JSON. Update the field list to include `jira_mcp`:

Change:
```
Parse JSON for: `researcher_model`, `synthesizer_model`, `roadmapper_model`, `commit_docs`, `project_exists`, `has_codebase_map`, `planning_exists`, `has_existing_code`, `has_package_file`, `is_brownfield`, `needs_codebase_map`, `has_git`.
```

To:
```
Parse JSON for: `researcher_model`, `synthesizer_model`, `roadmapper_model`, `commit_docs`, `project_exists`, `has_codebase_map`, `planning_exists`, `has_existing_code`, `has_package_file`, `is_brownfield`, `needs_codebase_map`, `has_git`, `jira_mcp`.
```

**Step 2: Insert Step 1.5 after Step 1**

After the git init block (the last part of Step 1, around line 53) and before Step 2 (Brownfield Offer, line ~55), insert this new section:

```markdown
## 1.5. Jira Integration Check

**Non-blocking check — project creation always proceeds regardless of result.**

Read `jira_mcp` from init JSON (parsed in Step 1).

**If `jira_mcp.available` is false:**

Display informational banner:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 JIRA INTEGRATION
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Jira integration is not currently set up.

This is optional — all planning features work without it.
When configured, it enables ticket lookup and validation.

Setup guides:
  Atlassian Cloud: .claude/get-shit-done/templates/mcp-setup/jira-rovo.md
  Jira Server/DC:  .claude/get-shit-done/templates/mcp-setup/jira-community.md

Continuing with project setup...
```

Do NOT ask the user to set up Jira now. Do NOT pause for input. Display the banner and continue immediately to Step 2.

**If `jira_mcp.available` is true:**

No banner needed. Silently store availability for future features:

```bash
node ./.claude/get-shit-done/bin/gsd-tools.js config-set jira_mcp_available true
node ./.claude/get-shit-done/bin/gsd-tools.js config-set jira_mcp_server "${jira_mcp.serverName}"
```

These config-set calls use the existing `config-set` subcommand (line 5577 of gsd-tools.js) to persist MCP status in config.json. If config.json doesn't exist yet (first-time setup), config-set creates it.

Continue to Step 2.
```

**Step 3: Renumber subsequent steps (NOT needed)**

Steps 2-9 keep their existing numbers. Step 1.5 uses a decimal number to avoid renumbering the entire workflow (matching the project's phase numbering convention for insertions).

**IMPORTANT:**
- The banner MUST NOT block project creation — it's purely informational
- The banner MUST NOT ask the user to install Jira MCP right now
- Use "Jira integration" not "Jira MCP server" in all user-facing text
- Do NOT add any conditional logic elsewhere in the workflow based on MCP status
- The config-set calls for "available: true" case happen BEFORE config.json is formally created in Step 5 — config-set handles creating the file if needed
  </action>
  <verify>
1. `grep -n "1.5" get-shit-done/workflows/new-project.md` — confirms Step 1.5 exists
2. `grep -n "jira_mcp" get-shit-done/workflows/new-project.md` — confirms field parsed and used
3. `grep -n "mcp-setup" get-shit-done/workflows/new-project.md` — confirms setup guide paths referenced
4. `grep -c "block\|require\|must.*install" get-shit-done/workflows/new-project.md` — verify no blocking language around Jira check (may have matches in other contexts; verify those in Step 1.5 are non-blocking)
5. Steps 2-9 still exist with original numbering
6. `grep -n "Continuing with project setup" get-shit-done/workflows/new-project.md` — confirms non-blocking continuation
  </verify>
  <done>
Step 1.5 injected into new-project.md workflow between Setup and Brownfield Offer. Non-blocking informational banner displayed when Jira MCP unavailable. Silent config storage when available. Setup guide paths provided. No blocking or prompting. Core workflow unchanged.
  </done>
</task>

</tasks>

<verification>
1. `node get-shit-done/bin/gsd-tools.js init new-project --raw 2>/dev/null` contains `jira_mcp` field
2. new-project.md Step 1.5 reads jira_mcp from init JSON (not a separate CLI call)
3. Warning banner uses PM-friendly language ("Jira integration" not "Jira MCP server")
4. No step in new-project.md blocks on Jira MCP status
5. Steps 2-9 of new-project.md are unchanged
6. Config storage (config-set) only happens when MCP is available (true case)
</verification>

<success_criteria>
- Init new-project response includes jira_mcp status object
- new-project.md has Step 1.5 between Setup and Brownfield Offer
- Informational banner shown when Jira MCP unavailable (non-blocking)
- Setup guide file paths included in banner
- Silent config storage when Jira MCP is available
- No workflow behavior changes based on MCP status (detection only)
- Project creation proceeds identically regardless of MCP availability
</success_criteria>

<output>
After completion, create `.planning/phases/05-jira-integration/05-02-SUMMARY.md`
</output>
