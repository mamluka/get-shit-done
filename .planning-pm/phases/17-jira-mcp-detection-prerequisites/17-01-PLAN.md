---
phase: 17-jira-mcp-detection-prerequisites
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/gsd/sync-jira.md
  - get-shit-done/workflows/sync-jira.md
autonomous: true

must_haves:
  truths:
    - "User sees clear install command (`claude mcp add jira --transport http https://mcp.atlassian.com/v1/mcp`) when Jira MCP is not available"
    - "User is blocked with actionable message when notion-sync.json does not exist, with guidance to run `/gsd:sync-notion` first"
    - "User can view a list of available Jira projects and select one by number"
    - "Selected Jira project ID and key are saved to .planning/config.json under jira.project_id and jira.project_key"
  artifacts:
    - path: "commands/gsd/sync-jira.md"
      provides: "Slash command entry point for /gsd:sync-jira"
      contains: "gsd:sync-jira"
    - path: "get-shit-done/workflows/sync-jira.md"
      provides: "Full workflow with MCP detection, notion-sync check, project selection, and config save"
      contains: "mcp__jira__getAccessibleAtlassianResources"
  key_links:
    - from: "commands/gsd/sync-jira.md"
      to: "get-shit-done/workflows/sync-jira.md"
      via: "execution_context @-reference"
      pattern: "@~/.claude/get-shit-done/workflows/sync-jira.md"
    - from: "get-shit-done/workflows/sync-jira.md"
      to: ".planning/config.json"
      via: "gsd-tools.js config-set for persisting Jira project selection"
      pattern: "config-set jira\\.project"
---

<objective>
Create the `/gsd:sync-jira` command and workflow that validates the Jira MCP environment and collects configuration needed for subsequent Jira sync phases (18-21).

Purpose: This is the entry point for the entire v1.4 Jira Sync feature. It gates all downstream operations (ticket creation, assignment, tracking) behind three prerequisites: Jira MCP availability, Notion sync completion, and Jira project selection. Phases 18-21 will extend this workflow with granularity selection, ticket creation, assignment, and update semantics.

Output: Two files - `commands/gsd/sync-jira.md` (command entry point) and `get-shit-done/workflows/sync-jira.md` (orchestration workflow with 4 steps).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing patterns to follow
@commands/gsd/sync-notion.md
@get-shit-done/workflows/sync-notion.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sync-jira command and workflow files</name>
  <files>commands/gsd/sync-jira.md, get-shit-done/workflows/sync-jira.md</files>
  <action>
Create TWO files following the established command/workflow pattern from sync-notion.

**File 1: `commands/gsd/sync-jira.md`**

Create a thin command wrapper following the exact structure of `commands/gsd/sync-notion.md`:
- Frontmatter: name `gsd:sync-jira`, description "Push planning artifacts to Jira as epic and tickets"
- allowed-tools: Read, Bash, Grep, Glob, Write, AskUserQuestion, plus ALL `mcp__jira__*` tools (getAccessibleAtlassianResources, getVisibleJiraProjects, createJiraIssue, editJiraIssue, searchJiraIssuesUsingJql, lookupJiraAccountId, getJiraProjectIssueTypesMetadata, getJiraIssueRemoteIssueLinks, getTransitionsForJiraIssue)
- objective section: "Sync planning artifacts to Jira. Validates Jira MCP, checks Notion sync state, selects target project, then creates/updates tickets."
- execution_context: `@~/.claude/get-shit-done/workflows/sync-jira.md`
- process: "Execute the sync-jira workflow from @~/.claude/get-shit-done/workflows/sync-jira.md end-to-end."

**File 2: `get-shit-done/workflows/sync-jira.md`**

Create the workflow file with `<purpose>`, `<required_reading>`, and `<process>` sections matching the sync-notion.md structure. The workflow has 4 steps:

**Step 1: `check_jira_mcp`**
- Run `node ~/.claude/get-shit-done/bin/gsd-tools.js check-jira-mcp` to detect Jira MCP
- Parse the JSON result: check `available` field
- If `available` is `false`: Display banner message:
  ```
  Jira MCP is not configured. Install it with:

    claude mcp add jira --transport http https://mcp.atlassian.com/v1/mcp

  Then restart Claude Code and run /gsd:sync-jira again.
  ```
  Stop.
- If `available` is `true`: Display "Jira MCP detected: {serverName}" and continue

**Step 2: `check_notion_sync`**
- Use inline Node.js (same pattern as sync-notion's validate_config step) to check if notion-sync.json exists:
  ```javascript
  var fs = require("fs");
  var path = require("path");
  var planningRoot = path.join(process.cwd(), ".planning");
  var activeProjectPath = path.join(planningRoot, ".active-project");
  var syncPath;
  try {
    if (fs.existsSync(activeProjectPath)) {
      var slug = fs.readFileSync(activeProjectPath, "utf8").trim();
      if (slug && fs.existsSync(path.join(planningRoot, slug))) {
        syncPath = path.join(planningRoot, slug, "notion-sync.json");
      }
    }
  } catch (e) {}
  if (!syncPath) syncPath = path.join(planningRoot, "notion-sync.json");
  var exists = fs.existsSync(syncPath);
  var hasPages = false;
  if (exists) {
    try {
      var state = JSON.parse(fs.readFileSync(syncPath, "utf8"));
      hasPages = state.projects && Object.keys(state.projects).length > 0;
    } catch(e) {}
  }
  console.log(JSON.stringify({ exists: exists, has_pages: hasPages, path: syncPath }));
  ```
- Parse JSON result
- If `exists` is `false` OR `has_pages` is `false`: Display:
  ```
  Notion sync is required before Jira sync. Planning docs must be synced to Notion first so Jira tickets can include Notion page links.

  Run: /gsd:sync-notion

  Then run /gsd:sync-jira again.
  ```
  Stop.
- If both true: Display "Notion sync state found. Notion page links will be included on Jira tickets." and continue.

**Step 3: `select_jira_project`**
- First, call `mcp__jira__getAccessibleAtlassianResources` to get the cloudId
- Extract the first cloudId from the response
- Then call `mcp__jira__getVisibleJiraProjects` with the cloudId to list projects
- Display a numbered list of projects showing: number, project key, project name
- Use AskUserQuestion to prompt: "Select a Jira project by number:"
- Validate the selection is a valid number in range
- Extract the selected project's `id` and `key`

**Step 4: `save_jira_config`**
- Run two config-set commands to save the selection:
  ```bash
  node ~/.claude/get-shit-done/bin/gsd-tools.js config-set jira.project_id "{selected_id}"
  node ~/.claude/get-shit-done/bin/gsd-tools.js config-set jira.project_key "{selected_key}"
  node ~/.claude/get-shit-done/bin/gsd-tools.js config-set jira.cloud_id "{cloud_id}"
  ```
- Display success banner:
  ```
  GSD > JIRA SYNC CONFIGURED

  Project: {key} - {name}
  Cloud ID: {cloud_id}

  Ready for ticket creation. This workflow will be extended in future phases.
  ```

Important implementation notes:
- Follow the exact markdown structure of sync-notion.md (purpose, required_reading referencing ui-brand.md, process with named steps)
- Use `<step name="...">` tags for each step, matching sync-notion pattern
- Each step must have clear conditional branching with "Stop." to halt on failure
- The workflow must display a banner at the start matching the GSD brand pattern:
  ```
  GSD > SYNCING TO JIRA
  ```
- Store cloudId alongside project info since it's needed for all subsequent MCP calls in Phases 18-21
  </action>
  <verify>
Both files exist and have correct structure:
```bash
test -f commands/gsd/sync-jira.md && echo "command exists" || echo "MISSING"
test -f get-shit-done/workflows/sync-jira.md && echo "workflow exists" || echo "MISSING"
grep -q "gsd:sync-jira" commands/gsd/sync-jira.md && echo "command name ok" || echo "MISSING name"
grep -q "check_jira_mcp" get-shit-done/workflows/sync-jira.md && echo "step 1 ok" || echo "MISSING step 1"
grep -q "check_notion_sync" get-shit-done/workflows/sync-jira.md && echo "step 2 ok" || echo "MISSING step 2"
grep -q "select_jira_project" get-shit-done/workflows/sync-jira.md && echo "step 3 ok" || echo "MISSING step 3"
grep -q "save_jira_config" get-shit-done/workflows/sync-jira.md && echo "step 4 ok" || echo "MISSING step 4"
grep -q "mcp__jira__getAccessibleAtlassianResources" get-shit-done/workflows/sync-jira.md && echo "MCP call ok" || echo "MISSING MCP"
grep -q "config-set jira" get-shit-done/workflows/sync-jira.md && echo "config save ok" || echo "MISSING config"
```
All checks must output "ok" or "exists".
  </verify>
  <done>
- commands/gsd/sync-jira.md exists with correct frontmatter, objective, and workflow reference
- get-shit-done/workflows/sync-jira.md exists with 4 named steps: check_jira_mcp, check_notion_sync, select_jira_project, save_jira_config
- Step 1 calls gsd-tools.js check-jira-mcp and shows install command on failure
- Step 2 checks notion-sync.json existence using sync-state resolution logic and blocks with guidance on failure
- Step 3 uses mcp__jira__getAccessibleAtlassianResources and mcp__jira__getVisibleJiraProjects to list projects for user selection
- Step 4 saves project_id, project_key, and cloud_id to config.json under jira section using config-set
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate workflow references and cross-file consistency</name>
  <files>commands/gsd/sync-jira.md, get-shit-done/workflows/sync-jira.md</files>
  <action>
Verify cross-file consistency between command and workflow:

1. Confirm the command's `execution_context` path matches the actual workflow file location
2. Confirm all MCP tool names listed in the command's `allowed-tools` are actually used or will be used (by Phase 18-21 extensions) in the workflow
3. Confirm the workflow's inline Node.js for notion-sync.json resolution matches the actual pattern in `lib/notion/sync-state.js` (resolveSyncStatePath function)
4. Confirm the config-set key paths (jira.project_id, jira.project_key, jira.cloud_id) use dot notation compatible with gsd-tools.js cmdConfigSet function
5. Confirm the `check-jira-mcp` subcommand exists in gsd-tools.js (it does â€” line 5997)
6. Confirm the install command shown to the user is correct: `claude mcp add jira --transport http https://mcp.atlassian.com/v1/mcp`

If any inconsistencies found, fix them in the affected file.
  </action>
  <verify>
```bash
# Verify command references workflow correctly
grep "sync-jira.md" commands/gsd/sync-jira.md | head -2

# Verify workflow uses correct gsd-tools subcommand
grep "check-jira-mcp" get-shit-done/workflows/sync-jira.md | head -1

# Verify config-set dot notation
grep "config-set jira\." get-shit-done/workflows/sync-jira.md | head -3

# Verify install command
grep "claude mcp add jira" get-shit-done/workflows/sync-jira.md | head -1
```
All grep commands return matching lines.
  </verify>
  <done>
- Command execution_context path resolves to actual workflow file
- MCP tool names in allowed-tools are valid mcp__jira__* names
- Notion sync state resolution logic matches lib/notion/sync-state.js pattern
- Config-set dot notation paths are compatible with gsd-tools.js
- check-jira-mcp subcommand exists in gsd-tools.js
- Install command is correct
  </done>
</task>

</tasks>

<verification>
Phase 17 verification checklist:
1. `/gsd:sync-jira` command file exists at `commands/gsd/sync-jira.md` with proper frontmatter
2. Workflow file exists at `get-shit-done/workflows/sync-jira.md` with 4 named steps
3. Step 1 (check_jira_mcp) calls existing `check-jira-mcp` gsd-tools subcommand and displays install command on failure
4. Step 2 (check_notion_sync) checks notion-sync.json using multi-project-aware path resolution and blocks with guidance on missing
5. Step 3 (select_jira_project) uses `mcp__jira__getAccessibleAtlassianResources` then `mcp__jira__getVisibleJiraProjects` with user selection via AskUserQuestion
6. Step 4 (save_jira_config) persists cloud_id, project_id, and project_key to config.json jira section
7. Workflow will be extensible by Phases 18-21 (step 4 ends cleanly, subsequent phases add steps after it)
</verification>

<success_criteria>
- Two files created: commands/gsd/sync-jira.md and get-shit-done/workflows/sync-jira.md
- Workflow gates: Jira MCP not available blocks with install command, missing notion-sync.json blocks with /gsd:sync-notion guidance
- Workflow completes: User selects Jira project, selection saved to config.json
- All cross-references between files are valid (command -> workflow, workflow -> gsd-tools.js, workflow -> MCP tools)
</success_criteria>

<output>
After completion, create `.planning/phases/17-jira-mcp-detection-prerequisites/17-01-SUMMARY.md`
</output>
